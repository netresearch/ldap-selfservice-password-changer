<!-- prettier-ignore -->
{{ define "EyeSlashIcon" }}
<!-- heroicons eye-slash -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 24 24"
  class="on-content-hidden h-4 w-4"
>
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12c1.292 4.338 5.31 7.5 10.066 7.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 0 1-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "EyeIcon" }}
<!-- heroicons eye -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 24 24"
  class="on-content-revealed hidden h-4 w-4"
>
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178c.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"
    />
    <path d="M15 12a3 3 0 1 1-6 0a3 3 0 0 1 6 0Z" />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "LoadingIcon" }}
<!-- ant-design loading-3-quaters-outlined -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 1024 1024"
  class="my-1 hidden h-4 w-4 animate-spin"
>
  <path
    fill="currentColor"
    d="M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3c22.2 52.4 53.9 99.5 94.3 139.9c40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6c52.4-22.2 99.5-53.9 139.9-94.3c40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9a437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7c26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7c-63.1 26.8-130.2 40.3-199.3 40.3z"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "CheckIcon" }}
<!-- heroicons check -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="m4.5 12.75l6 6l9-13.5"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "SunIcon" }}
<!-- heroicons sun -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0a3.75 3.75 0 0 1 7.5 0Z"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "MoonIcon" }}
<!-- heroicons moon -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="M21.752 15.002A9.718 9.718 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75c0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "ComputerIcon" }}
<!-- heroicons computer-desktop -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"/>
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "input" }}
<div
  id="{{ .Name }}"
  class="reveal-button:text-gray-700 dark:reveal-button:text-gray-300 reveal-eye:block reveal-eye-slash:hidden nonreveal-eye:hidden nonreveal-eye-slash:block space-y-[2px]"
  data-revealed="false"
>
  <label for="input-{{ .Name }}" class="sr-only">{{ .Placeholder }}</label>
  <div
    class="bg-opacity-0 input-focus:border-blue-500 dark:input-focus:border-blue-400 flex gap-2 rounded-md border border-gray-400 bg-white py-1.5 pr-1 pl-3 transition-colors outline-none dark:border-gray-500 dark:bg-gray-800 [&:has(input[disabled])]:bg-gray-50 dark:[&:has(input[disabled])]:bg-gray-900"
    data-purpose="inputContainer"
  >
    <input
      id="input-{{ .Name }}"
      type="{{ .Type }}"
      name="{{ .Name }}"
      placeholder="{{ .Placeholder }}"
      autocomplete="{{ .Autocomplete }}"
      class="flex-1 bg-transparent text-gray-900 outline-none placeholder:text-gray-500 placeholder:select-none dark:text-gray-100 dark:placeholder:text-gray-400"
      aria-describedby="errors-{{ .Name }}"
      aria-invalid="false"
    />

    {{ if eq .Type "password" }}
    <button
      type="button"
      class="flex items-center rounded-sm px-2 py-2 text-gray-500 outline-none hover:text-gray-700 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:text-gray-200 dark:focus:ring-blue-400"
      data-purpose="reveal"
      aria-label="Show password"
      aria-pressed="false"
    >
      <!-- prettier-ignore -->
      {{ template "EyeSlashIcon" }}
      <!-- prettier-ignore -->
      {{ template "EyeIcon" }}
    </button>
    {{ end }}
  </div>
  <div
    id="errors-{{ .Name }}"
    class="text-xs text-red-700 dark:text-red-400"
    data-purpose="errors"
    role="alert"
    aria-live="polite"
  ></div>
</div>
{{ end }}

<!doctype html>
<html lang="en" class="h-full bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-gray-50">
  <head>
    <title>LDAP Password Changer</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="darkreader-lock" />
    <script>
      // Initialize theme before page renders to prevent flash
      const storedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (storedTheme === "dark") {
        document.documentElement.classList.add("dark");
      } else if (storedTheme === "light") {
        document.documentElement.classList.remove("dark");
      } else if (!storedTheme || storedTheme === "auto") {
        // Auto mode: follow OS preference
        if (prefersDark) {
          document.documentElement.classList.add("dark");
        }
      }
    </script>

    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png" />
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    <link rel="manifest" href="/static/site.webmanifest" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <link rel="mask-icon" href="/static/safari-pinned-tab.svg" color="#000000" />
    <meta name="theme-color" content="#b8e9f4" />
    <meta name="msapplication-TileColor" content="#b8e9f4" />

    <link rel="preload" href="/static/styles.css" as="style" />
    <link rel="modulepreload" href="/static/js/validators.js" crossorigin="anonymous" />
    <link rel="modulepreload" href="/static/js/app.js" crossorigin="anonymous" />

    <link rel="stylesheet" href="/static/styles.css" />
  </head>

  <body class="flex min-h-full items-center justify-center p-4">
    <div
      class="relative max-w-lg space-y-4 rounded-lg border border-gray-400 bg-white p-8 shadow-sm dark:border-gray-600 dark:bg-gray-900"
    >
      <div class="flex justify-center">
        <img src="/static/logo.webp" class="aspect-square h-28 w-28 sm:h-48 sm:w-48" alt="" />
      </div>

      <h1 class="text-center text-2xl font-semibold text-gray-900 dark:text-gray-100">Change Your Password</h1>

      <form class="space-y-4" id="form" aria-label="Password change form">
        <!-- prettier-ignore -->
        {{ template "input" InputOpts "username" "Username" "text" "username" }}
        <!-- prettier-ignore -->
        {{ template "input" InputOpts "current" "Current Password" "password" "current-password" }}
        <!-- prettier-ignore -->
        {{ template "input" InputOpts "new" "New Password" "password" "new-password" }}
        <!-- prettier-ignore -->
        {{ template "input" InputOpts "new2" "Confirm New Password" "password" "new-password" }}

        <div class="space-y-[2px]" data-purpose="submit">
          <button
            type="submit"
            class="flex w-full items-center justify-center rounded-md border border-blue-600 bg-blue-600 px-3 py-2 font-semibold text-white transition-colors outline-none hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-gray-100 dark:border-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-400 dark:focus:ring-offset-gray-900 dark:disabled:border-gray-700 dark:disabled:bg-gray-800 dark:disabled:text-gray-600 dark:disabled:hover:bg-gray-800 [&[data-loading='true']>span]:hidden [&[data-loading='true']>svg]:inline-block"
            data-loading="false"
            aria-busy="false"
          >
            <span>Change Password</span>

            <!-- prettier-ignore -->
            {{ template "LoadingIcon" }}
          </button>

          <div
            class="text-xs text-red-700 dark:text-red-400"
            data-purpose="errors"
            role="alert"
            aria-live="assertive"
          ></div>
        </div>
      </form>

      <div class="hidden space-y-4" data-purpose="successContainer" role="status" aria-live="polite">
        <div class="mx-auto h-12 w-12 text-green-700 dark:text-green-400" aria-hidden="true">
          {{ template "CheckIcon" }}
        </div>

        <p class="text-center font-semibold text-gray-900 dark:text-gray-100">
          Your password was changed successfully.
        </p>
      </div>

      <p class="text-center text-xs text-gray-500 dark:text-gray-400">
        Powered by
        <a
          href="https://github.com/netresearch/ldap-selfservice-password-changer"
          class="hocus:text-blue-700 dark:hocus:text-blue-400 hocus:underline break-keep outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-blue-400 dark:focus:ring-offset-gray-900"
        >
          netresearch/ldap-selfservice-password-changer
        </a>
      </p>

      <button
        type="button"
        id="themeToggle"
        class="absolute right-8 top-8 rounded-md border border-gray-400 p-2 text-gray-600 outline-none hover:bg-gray-100 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-800 dark:focus:ring-blue-400"
        aria-label="Toggle theme"
        data-theme="auto"
      >
        <span id="theme-light" class="hidden">{{ template "SunIcon" }}</span>
        <span id="theme-dark" class="hidden">{{ template "MoonIcon" }}</span>
        <span id="theme-auto">{{ template "ComputerIcon" }}</span>
      </button>
    </div>

    <script type="module" defer>
      import { init } from "/static/js/app.js";

      init({
        minLength: +"{{ .opts.MinLength }}",
        minNumbers: +"{{ .opts.MinNumbers }}",
        minSymbols: +"{{ .opts.MinSymbols }}",
        minUppercase: +"{{ .opts.MinUppercase }}",
        minLowercase: +"{{ .opts.MinLowercase }}",
        passwordCanIncludeUsername: "{{ .opts.PasswordCanIncludeUsername }}" === "true"
      });
    </script>
  </body>
</html>

<!-- prettier-ignore -->
{{ define "EyeSlashIcon" }}
<!-- heroicons eye-slash -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 24 24"
  class="on-content-hidden h-6 w-6"
>
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12c1.292 4.338 5.31 7.5 10.066 7.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 0 1-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "EyeIcon" }}
<!-- heroicons eye -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 24 24"
  class="on-content-revealed hidden h-6 w-6"
>
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178c.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"
    />
    <path d="M15 12a3 3 0 1 1-6 0a3 3 0 0 1 6 0Z" />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "LoadingIcon" }}
<!-- ant-design loading-3-quaters-outlined -->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="100%"
  height="100%"
  viewBox="0 0 1024 1024"
  class="my-1 hidden h-4 w-4 animate-spin"
>
  <path
    fill="currentColor"
    d="M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3c22.2 52.4 53.9 99.5 94.3 139.9c40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6c52.4-22.2 99.5-53.9 139.9-94.3c40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9a437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7c26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7c-63.1 26.8-130.2 40.3-199.3 40.3z"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "CheckIcon" }}
<!-- heroicons check -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="m4.5 12.75l6 6l9-13.5"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "SunIcon" }}
<!-- heroicons sun -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0a3.75 3.75 0 0 1 7.5 0Z"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "MoonIcon" }}
<!-- heroicons moon -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="M21.752 15.002A9.718 9.718 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75c0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "ComputerIcon" }}
<!-- heroicons computer-desktop -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "HelpIcon" }}
<!-- heroicons question-mark-circle -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-6 w-6">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0c1.172 1.025 1.172 2.687 0 3.712c-.203.179-.43.326-.67.442c-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0a9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "Squares2x2Icon" }}
<!-- heroicons squares-2x2 -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "SquaresPlusIcon" }}
<!-- heroicons squares-plus -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
    <path
      d="M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 0 0 2.25-2.25V6a2.25 2.25 0 0 0-2.25-2.25H6A2.25 2.25 0 0 0 3.75 6v2.25A2.25 2.25 0 0 0 6 10.5Zm0 9.75h2.25A2.25 2.25 0 0 0 10.5 18v-2.25a2.25 2.25 0 0 0-2.25-2.25H6a2.25 2.25 0 0 0-2.25 2.25V18A2.25 2.25 0 0 0 6 20.25Zm9.75-9.75H18a2.25 2.25 0 0 0 2.25-2.25V6A2.25 2.25 0 0 0 18 3.75h-2.25A2.25 2.25 0 0 0 13.5 6v2.25a2.25 2.25 0 0 0 2.25 2.25Z"
    />
  </g>
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "SparklesIcon" }}
<!-- heroicons sparkles -->
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" class="h-5 w-5">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183l.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394l-1.183.394a2.25 2.25 0 0 0-1.423 1.423z"
  />
</svg>
{{ end }}

<!-- prettier-ignore -->
{{ define "input" }}
<div
  id="{{ .Name }}"
  class="reveal-button:text-gray-700 dark:reveal-button:text-gray-300 reveal-eye:block reveal-eye-slash:hidden nonreveal-eye:hidden nonreveal-eye-slash:block space-y-[2px]"
  data-revealed="false"
>
  <div class="flex items-center gap-1">
    <label for="input-{{ .Name }}" class="text-xs font-semibold text-gray-900 uppercase dark:text-gray-100 comfortable:block compact:sr-only">
      {{ .Placeholder }}
    </label>
    {{ if .Help }}
    <div class="comfortable:contents compact:hidden">
      <button
        type="button"
        class="rounded-sm p-2.5 text-gray-500 outline-none hover:text-gray-700 focus:ring-2 focus:ring-gray-900 dark:text-gray-400 dark:hover:text-gray-300 dark:focus:ring-gray-300"
        data-purpose="help"
        aria-label="Help for {{ .Placeholder }}"
        aria-expanded="false"
        aria-controls="help-{{ .Name }}"
      >
        <!-- prettier-ignore -->
        {{ template "HelpIcon" }}
      </button>
    </div>
    {{ end }}
  </div>

  {{ if .Help }}
  <div
    id="help-{{ .Name }}"
    class="hidden rounded-md bg-gray-100 p-2 text-xs text-gray-700 dark:bg-gray-800 dark:text-gray-300"
    data-purpose="helpText"
    role="region"
    aria-live="polite"
  >
    {{ .Help }}
  </div>
  {{ end }}

  <div
    class="bg-opacity-0 input-focus:!border-gray-900 input-focus:ring-2 input-focus:ring-gray-900 dark:input-focus:!border-gray-100 dark:input-focus:ring-gray-100 error-input-focus:!border-red-900 error-input-focus:ring-2 error-input-focus:ring-red-900 dark:error-input-focus:!border-red-300 dark:error-input-focus:ring-red-300 flex gap-2 rounded-md border-2 border-gray-300 bg-white pr-1 pl-3 transition-colors outline-none dark:border-gray-400 dark:bg-gray-800 [&:has(input[disabled])]:bg-gray-50 dark:[&:has(input[disabled])]:bg-gray-900 comfortable:py-2 compact:py-1.5"
    data-purpose="inputContainer"
  >
    <input
      id="input-{{ .Name }}"
      type="{{ .Type }}"
      name="{{ .Name }}"
      placeholder="{{ .Placeholder }}"
      autocomplete="{{ .Autocomplete }}"
      class="flex-1 bg-transparent text-gray-900 outline-none placeholder:text-gray-500 placeholder:select-none dark:text-gray-100 dark:placeholder:text-gray-400"
      aria-describedby="{{ if .Help }}help-{{ .Name }} {{ end }}errors-{{ .Name }}"
      aria-invalid="false"
    />

    {{ if eq .Type "password" }}
    <button
      type="button"
      class="flex items-center rounded-sm text-gray-500 outline-none hover:text-gray-700 focus:ring-2 focus:ring-gray-900 dark:text-gray-400 dark:hover:text-gray-200 dark:focus:ring-gray-300 comfortable:px-3 comfortable:py-2 compact:px-1.5 compact:py-1"
      data-purpose="reveal"
      aria-label="Show password"
      aria-pressed="false"
    >
      <!-- prettier-ignore -->
      {{ template "EyeSlashIcon" }}
      <!-- prettier-ignore -->
      {{ template "EyeIcon" }}
    </button>
    {{ end }}
  </div>
  <div
    id="errors-{{ .Name }}"
    class="text-xs text-red-700 dark:text-red-400"
    data-purpose="errors"
    role="alert"
    aria-live="polite"
  ></div>
</div>
{{ end }}

<!doctype html>
<html lang="en" class="h-full bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-gray-50">
  <head>
    <title>Password Changer</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="darkreader-lock" />
    <script>
      // Initialize theme before page renders to prevent flash
      const storedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (storedTheme === "dark") {
        document.documentElement.classList.add("dark");
      } else if (storedTheme === "light") {
        document.documentElement.classList.remove("dark");
      } else if (!storedTheme || storedTheme === "auto") {
        // Auto mode: follow OS preference
        if (prefersDark) {
          document.documentElement.classList.add("dark");
        }
      }
    </script>

    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png" />
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    <link rel="manifest" href="/static/site.webmanifest" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <link rel="mask-icon" href="/static/safari-pinned-tab.svg" color="#000000" />
    <meta name="theme-color" content="#b8e9f4" />
    <meta name="msapplication-TileColor" content="#b8e9f4" />

    <link rel="preload" href="/static/styles.css" as="style" />
    <link rel="modulepreload" href="/static/js/validators.js" crossorigin="anonymous" />
    <link rel="modulepreload" href="/static/js/app.js" crossorigin="anonymous" />

    <link rel="stylesheet" href="/static/styles.css" />
  </head>

  <body class="flex min-h-full items-center justify-center p-4">
    <div
      class="relative max-w-lg rounded-lg border border-gray-400 bg-white shadow-sm dark:border-gray-600 dark:bg-gray-900 comfortable:space-y-4 comfortable:p-8 compact:space-y-3 compact:p-6"
      data-density="comfortable"
    >
      <header role="banner">
        <div class="flex justify-center">
          <img src="/static/logo.webp" fetchpriority="high" class="aspect-square comfortable:h-28 comfortable:w-28 comfortable:sm:h-48 comfortable:sm:w-48 compact:h-24 compact:w-24 compact:sm:h-32 compact:sm:w-32" alt="" />
        </div>
      </header>

      <main role="main">
        <h1 class="text-center text-2xl font-semibold text-gray-900 dark:text-gray-100 comfortable:block compact:sr-only">Change Your Password</h1>

        <h2 class="sr-only">Password Change Form</h2>
        <form class="space-y-4" id="form" aria-label="Password change form" autocomplete="on">
          <!-- prettier-ignore -->
          {{ template "input" InputOpts "username" "Username" "text" "username" "Enter your network username (e.g., firstname.lastname)" }}
          <!-- prettier-ignore -->
          {{ template "input" InputOpts "current" "Current Password" "password" "current-password" "Enter your current password to verify your identity" }}
          <!-- prettier-ignore -->
          {{ template "input" InputOpts "new" "New Password" "password" "new-password" "Your new password must be strong and meet all security requirements shown below when you start typing" }}
          <!-- prettier-ignore -->
          {{ template "input" InputOpts "new2" "Confirm New Password" "password" "new-password" "Re-enter your new password to confirm" }}

          <div class="space-y-[2px]" data-purpose="submit">
            <button
              type="submit"
              class="flex w-full items-center justify-center rounded-md border border-blue-600 bg-blue-600 font-semibold text-white transition-colors outline-none hover:bg-blue-700 focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-gray-100 dark:border-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-gray-300 dark:focus:ring-offset-gray-900 dark:disabled:border-gray-700 dark:disabled:bg-gray-800 dark:disabled:text-gray-600 dark:disabled:hover:bg-gray-800 [&[data-loading='true']>span]:hidden [&[data-loading='true']>svg]:inline-block comfortable:px-3 comfortable:py-2 compact:px-2.5 compact:py-1.5 compact:text-sm"
              data-loading="false"
              aria-busy="false"
            >
              <span>Change Password</span>

              <!-- prettier-ignore -->
              {{ template "LoadingIcon" }}
            </button>

            <div
              class="text-xs text-red-700 dark:text-red-400"
              data-purpose="errors"
              role="alert"
              aria-live="assertive"
            ></div>
          </div>
        </form>

        <h2 class="sr-only">Success Message</h2>
        <div class="hidden space-y-4" data-purpose="successContainer" role="status" aria-live="polite">
          <div class="mx-auto h-12 w-12 text-green-700 dark:text-green-400" aria-hidden="true">
            {{ template "CheckIcon" }}
          </div>

          <p class="text-center font-semibold text-gray-900 dark:text-gray-100">
            Your password was changed successfully.
          </p>
        </div>
      </main>

      <footer role="contentinfo">
        <p class="text-center text-xs text-gray-500 dark:text-gray-400">
          Powered by
          <a
            href="https://github.com/netresearch/ldap-selfservice-password-changer"
            class="hocus:text-blue-700 dark:hocus:text-blue-400 hocus:underline break-keep outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 dark:focus:ring-gray-300 dark:focus:ring-offset-gray-900"
          >
            netresearch/ldap-selfservice-password-changer
          </a>
        </p>
      </footer>

      <button
        type="button"
        id="densityToggle"
        class="absolute top-4 right-16 rounded-md border border-gray-400 p-2.5 text-gray-600 outline-none hover:bg-gray-100 focus:ring-2 focus:ring-gray-900 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-800 dark:focus:ring-gray-300"
        aria-label="Display density"
        data-density-mode="auto"
      >
        <span id="density-comfortable" class="hidden">{{ template "Squares2x2Icon" }}</span>
        <span id="density-compact" class="hidden">{{ template "SquaresPlusIcon" }}</span>
        <span id="density-auto">{{ template "SparklesIcon" }}</span>
      </button>

      <button
        type="button"
        id="themeToggle"
        class="absolute top-4 right-4 rounded-md border border-gray-400 p-2.5 text-gray-600 outline-none hover:bg-gray-100 focus:ring-2 focus:ring-gray-900 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-800 dark:focus:ring-gray-300"
        aria-label="Theme"
        data-theme="auto"
      >
        <span id="theme-light" class="hidden">{{ template "SunIcon" }}</span>
        <span id="theme-dark" class="hidden">{{ template "MoonIcon" }}</span>
        <span id="theme-auto">{{ template "ComputerIcon" }}</span>
      </button>
    </div>

    <script type="module" defer>
      import { init } from "/static/js/app.js";

      init({
        minLength: +"{{ .opts.MinLength }}",
        minNumbers: +"{{ .opts.MinNumbers }}",
        minSymbols: +"{{ .opts.MinSymbols }}",
        minUppercase: +"{{ .opts.MinUppercase }}",
        minLowercase: +"{{ .opts.MinLowercase }}",
        passwordCanIncludeUsername: "{{ .opts.PasswordCanIncludeUsername }}" === "true"
      });
    </script>
  </body>
</html>
